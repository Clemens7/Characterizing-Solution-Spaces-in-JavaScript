export 


export function retrieveFromStorage(queryElems) {
    const key = queryElems.join(' ');
    if (key in localStorage) {
        console.log(`Retrieving ${key} from local storage`);
        return JSON.parse(localStorage[key]);
    }
}

      import { getPrintSizes, render, calculatePrice } from './frame.js';
      import { store, retrieveFromStorage } from './art-cache.js';

      document.getElementById("pay-button").disabled = true;


      document.addEventListener('DOMContentLoaded', event => {

        document.getElementById("pay-button").disabled = false;

        if (localStorage.getItem('cart') === null)  else {

          getDataFromApi();

          let datas = retrieveFromStorage(['cart']);
          calculateSubTotal(datas);
        }
      })

      async function getDataFromApi() {
        const url = `https://web-engineering.big.tuwien.ac.at/s20/a2/shipping`;
        try {
          const response = await fetch(url);
          console.log(response);
          const data = await response.json();
          console.log(data.destinations);
          for (let i = 0; i < data.destinations.length; i++) {
            var selectionOfCountries = document.getElementById('country');
            selectionOfCountries.innerHTML += `<option value = "${data.destinations[i].country}"> ${data.destinations[i].displayName} </option>`;

            if (i == 0) {
              document.getElementById('price-shipping').innerHTML = `${(parseFloat((data.destinations[i].cost) / 100).toFixed(2))}`;
              calculateTotal();
            }

            selectionOfCountries.addEventListener("change", event => {
              var selection = selectionOfCountries.options[selectionOfCountries.selectedIndex].value;
              console.log(selection);

              for (let k = 0; k < data.destinations.length; k++) {
                if (selection == data.destinations[k].country) {
                  document.getElementById('price-shipping').innerHTML = `${(parseFloat((data.destinations[k].cost) / 100).toFixed(2))}`;
                  console.log((parseFloat((data.destinations[k].cost) / 100).toFixed(2)));
                }
              }
              calculateTotal();
            }
            )
          }
        }
        
      }


      async function calculateSubTotal(datas) {
        let subTotal = 0;
        for (let i = 0; i < datas.length; i++) {
          subTotal += parseFloat(calculatePrice(datas[i].printSize, datas[i].frameStyle, datas[i].frameWidth, datas[i].matWidth));
        }
        document.getElementById('price-subtotal').innerHTML = `${subTotal.toFixed(2)}`;
      }


  

      async function calculateTotal() {

        var calculateSub = document.getElementById('price-subtotal');
        var calcSubText = calculateSub.textContent;
        console.log(calcSubText);
        var subCost = Number(calcSubText);
        console.log(subCost);

        var calculateShipping = document.getElementById('price-shipping');
        var calcShipText = calculateShipping.textContent;
        console.log(calcShipText);
        var shippingCost = Number(calcShipText);
        console.log(shippingCost);

        let total = parseFloat(subCost + shippingCost).toFixed(2);
        document.getElementById("price-total").innerHTML = `${total}`;
      }

    export 

export 

export function calculatePrice(printSize, frameStyle, frameWidth, matWidth) {
    let price = 30.0;
    if(frameStyle == 'classic'){
        price += (0.1*frameWidth);
    } else if(frameStyle == 'natural'){
        price += (0.08*frameWidth);
    }else if(frameStyle == 'shabby'){
        price += (0.09*frameWidth);
    }
    price += 0.005*matWidth;
    if(printSize == 'L') else if( printSize == 'M'){
        price = price*2;
    } 
    price = (Math.round((price + Number.EPSILON) * 100) / 100);
    price = parseFloat(price.toFixed(2));
    return price;
}
